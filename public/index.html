<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faiel TransfÃªr</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <style>
        img {
            max-width: 200px;
            max-height: 200px;
            box-shadow: 0px 0px 10px -5px gray;
        }

        img:hover {
            filter:grayscale(1);
            filter:invert(1);
            cursor: pointer;
        }

        #imagesContainer {
            width: 100%;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            gap: 10px;
        }

        .imageCard {
            max-width: 200px;
            display: flex;
            flex-direction: column;
        }
    </style>
</head>
<body>
    <h1>This is the Home page!</h1>
    <p>We will be doing great things here!</p>
    <input type="file" id="fileInput">
    <br>
    <h2>Imagens:</h2>
    <p id="getResponse"></p>
    <div id="imagesContainer"></div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const fileInput = document.getElementById('fileInput')
            fileInput.addEventListener('input', () => tryPOST())
        })

        function tryDELETE(imageName){
            fetch("/delete-file/" + imageName, {
                method: "DELETE"
            })
            .then(response => response.json())
            .then(data => {
                console.log(data)
                cleanGET()
                tryGET()
                pMessage('Sucesso ao remover!')
            })
            .catch(error => pMessage('Erro ao remover: ' + error))
        }

        function cleanGET(){
            document.querySelectorAll('.imageCard').forEach((elmnt) => {
                elmnt.remove()
            })
        }

        function tryGET(){
            const imagesContainer = document.getElementById('imagesContainer')
            fetch("/all-images")
            .then(response => response.json())
            .then(data => {
                cleanGET()
                data.paths.forEach((path) => {
                    let imageName = path.split("/")[1]
                    imagesContainer.innerHTML += 
                    `
                    <div class="imageCard">
                    <img src="${path}" title="${imageName}" onclick="tryDELETE('${imageName}')">
                    ${imageName}
                    </div>
                    `
                })
            })
            .then(() => pMessage("Imagens acessadas!"))
            .catch(error => pMessage("Erro na busca: " + error))
        }

        function tryPOST(){
            const fileInput = document.getElementById('fileInput')
            const formData = new FormData();
            formData.append("file", fileInput.files[0])
            formData.append("username", "Username")
            fetch("/upload-file", {
                method: 'POST',
                body: formData
            })
            .then(response => {
                cleanGET()
                tryGET()
            })
            .then(() => pMessage('Sucesso ao enviar arquivo! '))
            .catch(error => pMessage('Erro ao enviar arquivo: ' + error))
        }

        function pMessage(message){
            const paragraphResponse = document.getElementById('getResponse')
            paragraphResponse.innerHTML = message
        }

        tryGET()
    </script>
</body>
</html>